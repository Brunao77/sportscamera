---
    const { key, title, inserted_at } = Astro.props
---

<div>
    <span>{title}</span>
    <time>{inserted_at}</time>
    <video controls></video>
</div>
<script is:inline define:vars={{ key }}>
    const video = document.getElementsByTagName('video')[0]
    video.addEventListener('play', ()=>{
        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.attachMedia(video);
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                hls.loadSource(`/api/videos/getVideo/${key}`);
                video.play();
            });
        }
    })
</script>